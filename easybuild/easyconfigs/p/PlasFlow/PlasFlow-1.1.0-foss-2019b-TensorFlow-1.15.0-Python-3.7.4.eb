# Author: Pavel Grochal (INUITS)
# License: GPLv2

easyblock = 'Tarball'

name = 'PlasFlow'
version = '1.1.0'
local_py_versionsuffix = '-Python-%(pyver)s'
versionsuffix = '-TensorFlow-1.15.0'
versionsuffix += local_py_versionsuffix



homepage = 'https://github.com/smaegol/PlasFlow'
description = """PlasFlow - predicting plasmid sequences in metagenomic data"""

toolchain = {'name': 'foss', 'version': '2019b'}

# https://github.com/smaegol/PlasFlow
github_account = 'smaegol'
source_urls = [GITHUB_SOURCE]
sources = ['v1.1.tar.gz']
patches = [
    '%(name)s-%(version)s_fixrpy2.patch',
]
checksums = [
    '40dc47812167a1ca60950d3d0c7db5bfffec9d72e66d1db20c92d3a2f2f44971',  # v1.1.tar.gz
    '03e6757cba192dec715c504d4b8a3cd0406574df6be4a30636f84390d8361da8',  # PlasFlow-1.1.0_fixrpy2.patch
]

skipsteps = ['build']

dependencies = [
    ('Python', '3.7.4'),
    ('Perl', '5.30.0'),
    ('R', '3.6.2'),
    ('BioPerl', '1.7.2'),
    ('Biopython', '1.75', local_py_versionsuffix),
    ('R-bundle-Bioconductor', '3.10'),
    ('rpy2', '3.2.6', local_py_versionsuffix),
    ('scikit-learn', '0.21.3', local_py_versionsuffix),
    ('SciPy-bundle', '2019.10', local_py_versionsuffix),
    ('TensorFlow', '1.15.0', local_py_versionsuffix),
]

modextrapaths = {'PATH': ['.', 'scripts']}

local_bin_files = [
    'calculate_cbar_predictions.sh', 'create_annotation_of_data.R', 'filter_sequences_by_length.pl',
    'get_refseq_catalog_filter.sh', 'get_refseq_genomes_complete.sh', 'PlasFlow_preprocessing.sh',
    'process_downloaded_genomes_get_accessions.R', 'calculate_recycler_predictions.sh', 'filter_large_file.pl',
    'generate_fragments_for_training.R', 'get_refseq_genomes_complete_get_download_links.R',
    'get_seqs_by_ids_list_cBar.pl', 'PlasFlow_train.py'
]

fix_python_shebang_for = ['PlasFlow.py', 'scripts/*.py']
fix_perl_shebang_for = ['scripts/*.pl']

sanity_check_paths = {
    'files': ['PlasFlow.py']+['scripts/%s' % f for f in local_bin_files],
    'dirs': [],
}

sanity_check_commands = [
    "PlasFlow.py --help",
]

moduleclass = 'bio'
