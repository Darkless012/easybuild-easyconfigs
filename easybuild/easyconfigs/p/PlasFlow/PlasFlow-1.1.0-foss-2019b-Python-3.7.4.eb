# Author: Pavel Grochal (INUITS)
# License: GPLv2

easyblock = 'Tarball'

name = 'PlasFlow'
version = '1.1.0'
versionsuffix = '-Python-%(pyver)s'

homepage = 'https://github.com/smaegol/PlasFlow'
description = """PlasFlow - predicting plasmid sequences in metagenomic data"""

toolchain = {'name': 'foss', 'version': '2019b'}

# https://github.com/smaegol/PlasFlow
github_account = 'smaegol'
source_urls = [GITHUB_SOURCE]
sources = ['v1.1.tar.gz']
patches = [
    '%(name)s-%(version)s_fixrpy2.patch',
]

skipsteps = ['build']

dependencies = [
    ('Python', '3.7.4'),
    ('Perl', '5.30.0'),
    ('R', '3.6.2'),
    ('BioPerl', '1.7.2'),
    ('Biopython', '1.75', versionsuffix),
    ('R-bundle-Bioconductor', '3.10'),
    ('rpy2', '3.2.6', versionsuffix),
    ('scikit-learn', '0.21.3', versionsuffix),
    ('SciPy-bundle', '2019.10', versionsuffix),
    ('TensorFlow', '1.15.0', versionsuffix),
]

modextrapaths = {'PATH': ['.', 'scripts']}


local_bin_files = [
    'calculate_cbar_predictions.sh', 'create_annotation_of_data.R', 'filter_sequences_by_length.pl',
    'get_refseq_catalog_filter.sh', 'get_refseq_genomes_complete.sh', 'PlasFlow_preprocessing.sh',
    'process_downloaded_genomes_get_accessions.R', 'calculate_recycler_predictions.sh', 'filter_large_file.pl',
    'generate_fragments_for_training.R', 'get_refseq_genomes_complete_get_download_links.R',
    'get_seqs_by_ids_list_cBar.pl', 'PlasFlow_train.py'
]

fix_python_shebang_for = ['PlasFlow.py', 'scripts/*.py']
fix_perl_shebang_for = ['scripts/*.pl']

sanity_check_paths = {
    'files': ['PlasFlow.py']+['scripts/%s' % f for f in local_bin_files],
    'dirs': [],
}

sanity_check_commands = [
    "PlasFlow.py --help",
    # "PlasFlow.py --input %(builddir)s/%(name)s-%(version)s/test/Citrobacter_freundii_strain_CAV1321_scaffolds.fasta --output test.plasflow_predictions.tsv --threshold 0.7"
]

moduleclass = 'bio'
